#!/usr/bin/env bash

branch=$(git rev-parse --abbrev-ref head)

git checkout head~2 -- test

[ -d test/module ] && {

  npm test -- $(find test/module -type f -name \*.js) || {
    git status -sb
    git checkout $branch
    npm version major -m "%s"
    exit 0
  }

  npm test -- $(find test -type f -name \*.js -not -path test/module/\*) || {
    git status -sb
    git checkout $branch
    npm version minor -m "%s"
    exit 0
  }

  git status -sb
  git checkout $branch
  npm version patch -m "%s"
  exit 0
}

exit 1
