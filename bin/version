#!/usr/bin/env bash

npm run test || exit 1
branch=$(git rev-parse --abbrev-ref head)

git checkout head~2 -- test

[ -d test/module ] && {

  npm test -- $(find test/module -type f -name \*.js) || {
    npm version major -m "%s"
    git checkout $branch
    exit 0
  }

  npm test -- $(find test -type f -name \*.js -not -path test/module/\*) || {
    npm version minor -m "%s"
    git checkout $branch
    exit 0
  }

  npm version patch -m "%s"
  git checkout $branch
  exit 0
}

exit 1
