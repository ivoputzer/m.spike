#!/usr/bin/env bash

branch=$(git rev-parse --abbrev-ref head)

git checkout head~2 -- test

[ -d test/module ] && {

  npm test -- $(find test/module -type f -name \*.js) || {
    npm version major -v -m "%s"
    git checkout $branch -- test
    exit 0
  }

  npm test -- $(find test -type f -name \*.js -not -path test/module/\*) || {
    npm version minor -v -m "%s"
    git checkout $branch -- test
    exit 0
  }

  npm version patch -v -m "%s"
  git checkout $branch -- test
  exit 0
}

exit 1
